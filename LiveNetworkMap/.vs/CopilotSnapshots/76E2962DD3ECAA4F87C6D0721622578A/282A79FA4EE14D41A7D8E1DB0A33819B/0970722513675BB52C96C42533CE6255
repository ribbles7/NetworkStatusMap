using System;
using System.Collections.Generic;
using System.Web.Script.Serialization;
using System.Xml;

namespace LiveNetworkMap
{
    public partial class Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            var serverList = new List<Server>();
            string xmlFilePath = Server.MapPath("~/servers.xml");

            XmlDocument doc = new XmlDocument();
            doc.Load(xmlFilePath);

            foreach (XmlNode node in doc.SelectNodes("/servers/server"))
            {
                serverList.Add(new Server
                {
                    Name = node["name"].InnerText,
                    Ip = node["ip"].InnerText,
                    Role = node["role"].InnerText,
                    Lat = Convert.ToDouble(node["lat"].InnerText),
                    Lon = Convert.ToDouble(node["lon"].InnerText)
                });
            }

            var jsonSerializer = new JavaScriptSerializer();
            string json = jsonSerializer.Serialize(serverList);

            Response.Clear();
            Response.ContentType = "application/json; charset=utf-8";
            Response.Write(json);
            Response.End();
        }
    }
}